var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,i=(e,i)=>{for(var o in i||(i={}))s.call(i,o)&&l(e,o,i[o]);if(t)for(var o of t(i))a.call(i,o)&&l(e,o,i[o]);return e};import{d as o,h as r,t as n,e as d,p as u,f as c,r as p,o as m,c as g,a as f,j as y,F as b,i as h,C as S,w as C,g as w}from"./vendor.3951c195.js";import{a as F,b as k,c as v,d as V,e as _,f as x}from"./other.ef94abb6.js";import"./axios.8390ffce.js";import"./index.37a8525d.js";var M=o({name:"index",setup(){const e=r({sites:[],isEditSite:"",siteForm:{site:"",name:"",hosts:""},siteStatus:"",ISPRODUCT:!1,dialogVisible:!1,percentage:0,uploadMsg:{},uploadMsgHistory:[]});e.ISPRODUCT="0";const t={async getSites(){e.sites=await F()},async deleteSite(e){try{await k(e.site),d.success("删除成功"),t.getSites()}catch(s){d.error(s.message)}},async updateSite(t){e.siteForm.site=t.site,e.siteForm.name=t.name,e.siteForm.hosts=t.hosts.join(","),e.isEditSite=t.site},async update(){e.siteForm.hosts=e.siteForm.hosts.replace(/\s/g,",").replace(/,+/,",");try{await v(e.siteForm),d.success("修改成功")}catch(s){d.error(s.message)}e.isEditSite="",t.getSites()},async changeStatus(e){try{await V(e.site),d.success("修改成功")}catch(t){d.error(t.message)}},async upload(s){try{e.dialogVisible=!0,t.addMsg({txt:"开始创建更新站点文件夹",status:"success"}),await _({name:s.name,site:s.site,hosts:s.hosts.join(","),isRemote:!0}),t.addMsg({txt:"站点文件夹创建更新完毕,准备请求上传",status:"success"}),await x(s.site),t.addMsg({txt:"请求完毕，开始上传",status:"success"});new WebSocket("ws://abc.le-so.cn:8084").onmessage=s=>{const a=JSON.parse(s.data);"uploading"===a.status&&t.addMsg({txt:`开始上传${a.filename}，当前为第${a.transferredFileCount}个，总共${a.totalFilesCount}个`,status:"warning"}),"uploaded"===a.status&&(t.addMsg({txt:`${a.filename}上传完毕，当前为第${a.transferredFileCount}个，总共${a.totalFilesCount}个`,status:"success"}),e.percentage=Number((a.transferredFileCount/a.totalFilesCount*100).toFixed(2))),"error"===a.status&&t.addMsg({txt:`${a.filename}上传失败，当前为第${a.transferredFileCount}个，总共${a.totalFilesCount}个`,status:"error"}),"success"===a.status&&t.addMsg({txt:"网站上传完毕",status:"success"})}}catch(a){}},cancel(){e.siteForm={site:"",name:"",hosts:""},e.isEditSite=""},addMsg(t){e.uploadMsg=t,e.uploadMsgHistory.unshift(t)}};return t.getSites(),i(i({},n(e)),t)}});const j=C();u("data-v-664310e6");const E={key:1},O={key:1},$={key:0},U=w("上传"),I=w("修改"),P=w("删除"),z={key:1},D=w("完成"),R=w("取消");c();const H=j(((e,t,s,a,l,i)=>{const o=p("el-table-column"),r=p("el-input"),n=p("el-switch"),d=p("el-button"),u=p("el-popconfirm"),c=p("el-table"),C=p("el-progress"),w=p("el-alert"),F=p("el-collapse-item"),k=p("el-collapse"),v=p("el-dialog");return m(),g("div",null,[f(c,{data:e.sites,style:{width:"100%"}},{default:j((()=>[f(o,{prop:"site",label:"英文ID"}),f(o,{prop:"name",label:"网站名称"},{default:j((({row:s})=>[e.isEditSite&&e.isEditSite===s.site?(m(),g(r,{key:0,modelValue:e.siteForm.name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.siteForm.name=t)},null,8,["modelValue"])):(m(),g("p",E,y(s.name),1))])),_:1}),f(o,{prop:"create_time",label:"创建时间"}),f(o,{prop:"hosts",label:"域名"},{default:j((({row:s})=>[e.isEditSite&&e.isEditSite===s.site?(m(),g(r,{key:0,type:"textarea",modelValue:e.siteForm.hosts,"onUpdate:modelValue":t[2]||(t[2]=t=>e.siteForm.hosts=t)},null,8,["modelValue"])):(m(),g("div",O,[(m(!0),g(b,null,h(s.hosts,(e=>(m(),g("p",{key:e},[f("a",{href:"http://"+e,target:"_blank",style:{color:"#333"}},y(e),9,["href"])])))),128))]))])),_:1}),f(o,{prop:"status",label:"状态"},{default:j((({row:t})=>[f(n,{modelValue:t.status,"onUpdate:modelValue":e=>t.status=e,"active-value":1,"inactive-value":0,onClick:s=>e.changeStatus(t)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:1}),f(o,{prop:"visit",label:"访问量"}),f(o,{label:"操作",width:"250"},{default:j((({row:t})=>[e.isEditSite.length?(m(),g("div",z,[f(d,{type:"success",size:"small",onClick:e.update},{default:j((()=>[D])),_:1},8,["onClick"]),f(d,{type:"warning",size:"small",onClick:e.cancel},{default:j((()=>[R])),_:1},8,["onClick"])])):(m(),g("div",$,["0"===e.ISPRODUCT?(m(),g(d,{key:0,type:"success",size:"small",onClick:s=>e.upload(t)},{default:j((()=>[U])),_:2},1032,["onClick"])):S("",!0),f(d,{type:"primary",size:"small",onClick:s=>e.updateSite(t)},{default:j((()=>[I])),_:2},1032,["onClick"]),f(u,{title:"确定删除吗？",onConfirm:s=>e.deleteSite(t)},{reference:j((()=>[f(d,{type:"danger",size:"small"},{default:j((()=>[P])),_:1})])),_:2},1032,["onConfirm"])]))])),_:1})])),_:1},8,["data"]),f(v,{title:"文件上传",modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=t=>e.dialogVisible=t),width:"600px","before-close":()=>e.dialogVisible=!1},{default:j((()=>[f("div",null,[f(C,{type:"dashboard",percentage:e.percentage},null,8,["percentage"]),f(w,{title:e.uploadMsg.txt,closable:!1,type:e.uploadMsg.status},null,8,["title","type"]),f(k,null,{default:j((()=>[f(F,{title:"历史信息",name:"1"},{default:j((()=>[(m(!0),g(b,null,h(e.uploadMsgHistory,(e=>(m(),g(w,{key:e.txt,title:e.txt,type:e.status,closable:!1},null,8,["title","type"])))),128))])),_:1})])),_:1})])])),_:1},8,["modelValue","before-close"])])}));M.render=H,M.__scopeId="data-v-664310e6";export default M;
