var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,o,l)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,s=(e,t)=>{for(var o in t||(t={}))a.call(t,o)&&i(e,o,t[o]);if(l)for(var o of l(t))r.call(t,o)&&i(e,o,t[o]);return e},d=(e,l)=>t(e,o(l));import{d as n,t as u,u as m,e as p,G as c,f,p as h,i as S,r as g,o as b,c as y,a as V,F as _,j as k,k as w,l as O,z as v,D as C,w as U,v as N,C as L}from"./vendor.a308f217.js";import{g as T,f as J,h as x}from"./index.9c2b56da.js";import{_ as I,a as D,b as j,c as E}from"./sort.3e2bedd4.js";import{_ as $}from"./index.5a424b2b.js";var P=n({name:"sortDetail",props:{sortTree:{type:Array,default:()=>[]},addScode:{type:String,default:""},models:{type:Array,default:()=>[]},update:{type:Boolean,default:!1},batch:{type:Boolean,default:!1}},components:{Upload:$},setup(e){u(e);const t=m(),o=p({formSort:{acode:t.state.acode,mcode:"",pcode:"",scode:"",name:"",listtpl:"",contenttpl:"",status:"1",outlink:"",subname:"",ico:"",pic:"",title:"",keywords:"",description:"",filename:"",sorting:255},emptySort:{},rules:{pcode:[{required:!0,message:"请选择父栏目",trigger:"change"}],name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],mcode:[{required:!0,message:"请选择模型类型",trigger:"change"}],listtpl:[{required:!0,message:"请输入列表页模板",trigger:"blur"}],contenttpl:[{required:!0,message:"请输入内容页模板",trigger:"blur"}]},originFormSort:{},batchName:[],inputVisible:!1,inputValue:"",options:["product","download","news","honor","plant","contact","culture","company","about","message",""]});return o.emptySort=JSON.parse(JSON.stringify(o.formSort)),c((()=>t.state.acode),((e,t)=>{o.formSort.acode=e})),s({},u(o))},computed:{formatTree(){const e=JSON.parse(JSON.stringify(this.sortTree));return e.unshift({name:"顶级栏目",scode:"0"}),e}},methods:{changeMcode(e){const t=this.models.find((t=>t.mcode==e));this.formSort.contenttpl=t.contenttpl,this.formSort.listtpl=t.listtpl},addOrUpdateSort(){this.$refs.form.validate((e=>{if(e)if(this.update)I({findOption:{id:this.formSort.id},data:this.formSort}).then((e=>{f.success("更新成功"),this.$emit("update-sort")})).catch((e=>{f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")}));else{let e;this.batch?e=this.batchName.map(((e,t)=>d(s({},this.formSort),{name:e,scode:(parseInt(this.addScode)+t).toString()}))):(this.formSort.scode=this.addScode,e=this.formSort),D(e).then((e=>{f.success("添加成功"),this.formSort=JSON.parse(JSON.stringify(this.emptySort)),this.$emit("update-sort")})).catch((e=>{f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")}))}}))},reset(){this.formSort=JSON.parse(JSON.stringify(this.originFormSort))},handleInputConfirm(){let e=this.inputValue;e&&this.batchName.push(e),this.inputVisible=!1,this.inputValue=""},showInput(){this.inputVisible=!0,this.$nextTick((()=>{this.$refs.saveTagInput.$refs.input.focus()}))},handleClose(e){this.batchName.splice(this.batchName.indexOf(e),1)}}});const q=U();h("data-v-16ea7762");const z=V("h3",null,"基本选项",-1),B={key:1},F=w("+ 新栏目"),M=w("显示"),A=w("隐藏"),K=V("h3",null,"高级选项",-1),G=w("立即提交"),H=w("重置");S();const Q=q(((e,t,o,l,a,r)=>{const i=g("el-divider"),s=g("el-cascader"),d=g("el-form-item"),n=g("el-input"),u=g("el-tag"),m=g("el-button"),p=g("el-option"),c=g("el-select"),f=g("el-radio"),h=g("el-radio-group"),S=g("el-form"),U=g("el-col"),N=g("upload"),L=g("el-row");return b(),y("div",null,[V(L,{gutter:20},{default:q((()=>[V(U,{span:e.batch?24:10,offset:0},{default:q((()=>[z,V(i),V(S,{ref:"form",rules:e.rules,model:e.formSort,"label-width":"100px"},{default:q((()=>[V(d,{label:"父栏目",prop:"pcode"},{default:q((()=>[V(s,{options:e.formatTree,modelValue:e.formSort.pcode,"onUpdate:modelValue":t[1]||(t[1]=t=>e.formSort.pcode=t),"show-all-levels":!1,props:{expandTrigger:"hover",checkStrictly:!0,value:"scode",label:"name",emitPath:!1}},null,8,["options","modelValue"])])),_:1}),V(d,{label:"栏目名称",prop:e.batch?"":"name"},{default:q((()=>[e.batch?(b(),y("div",B,[(b(!0),y(_,null,k(e.batchName,(t=>(b(),y(u,{key:t,closable:"","disable-transitions":!1,onClose:o=>e.handleClose(t)},{default:q((()=>[w(O(t),1)])),_:2},1032,["onClose"])))),128)),e.inputVisible?(b(),y(n,{key:0,class:"input-new-tag",modelValue:e.inputValue,"onUpdate:modelValue":t[3]||(t[3]=t=>e.inputValue=t),ref:"saveTagInput",size:"small",onKeyup:v(e.handleInputConfirm,["enter"]),onBlur:e.handleInputConfirm},null,8,["modelValue","onKeyup","onBlur"])):(b(),y(m,{key:1,class:"button-new-tag",size:"small",onClick:e.showInput},{default:q((()=>[F])),_:1},8,["onClick"]))])):(b(),y(n,{key:0,modelValue:e.formSort.name,"onUpdate:modelValue":t[2]||(t[2]=t=>e.formSort.name=t)},null,8,["modelValue"]))])),_:1},8,["prop"]),e.batch?C("",!0):(b(),y(d,{key:0,label:"栏目副名称"},{default:q((()=>[V(n,{modelValue:e.formSort.subname,"onUpdate:modelValue":t[4]||(t[4]=t=>e.formSort.subname=t)},null,8,["modelValue"])])),_:1})),V(d,{label:"内容模型",prop:"mcode"},{default:q((()=>[V(c,{modelValue:e.formSort.mcode,"onUpdate:modelValue":t[5]||(t[5]=t=>e.formSort.mcode=t),onChange:e.changeMcode},{default:q((()=>[(b(!0),y(_,null,k(e.models,(e=>(b(),y(p,{key:e.id,label:e.name,value:e.mcode},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),V(d,{label:"列表页模板",prop:"listtpl"},{default:q((()=>[V(n,{modelValue:e.formSort.listtpl,"onUpdate:modelValue":t[6]||(t[6]=t=>e.formSort.listtpl=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"内容页模板",prop:"contenttpl"},{default:q((()=>[V(n,{modelValue:e.formSort.contenttpl,"onUpdate:modelValue":t[7]||(t[7]=t=>e.formSort.contenttpl=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"状态"},{default:q((()=>[V(h,{modelValue:e.formSort.status,"onUpdate:modelValue":t[8]||(t[8]=t=>e.formSort.status=t)},{default:q((()=>[V(f,{label:"1"},{default:q((()=>[M])),_:1}),V(f,{label:"0"},{default:q((()=>[A])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["span"]),e.batch?C("",!0):(b(),y(U,{key:0,span:14,offset:0},{default:q((()=>[K,V(i),V(S,{ref:"form2",model:e.formSort,"label-width":"100px"},{default:q((()=>[V(d,{label:"自定义路径名"},{default:q((()=>[V(c,{modelValue:e.formSort.filename,"onUpdate:modelValue":t[9]||(t[9]=t=>e.formSort.filename=t)},{default:q((()=>[(b(!0),y(_,null,k(e.options,(e=>(b(),y(p,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(d,{label:"跳转链接"},{default:q((()=>[V(n,{modelValue:e.formSort.outlink,"onUpdate:modelValue":t[10]||(t[10]=t=>e.formSort.outlink=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"栏目略缩图"},{default:q((()=>[V(N,{modelValue:e.formSort.ico,"onUpdate:modelValue":t[11]||(t[11]=t=>e.formSort.ico=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"栏目大图"},{default:q((()=>[V(N,{modelValue:e.formSort.pic,"onUpdate:modelValue":t[12]||(t[12]=t=>e.formSort.pic=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"SEO标题"},{default:q((()=>[V(n,{modelValue:e.formSort.title,"onUpdate:modelValue":t[13]||(t[13]=t=>e.formSort.title=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"SEO关键字"},{default:q((()=>[V(n,{modelValue:e.formSort.keywords,"onUpdate:modelValue":t[14]||(t[14]=t=>e.formSort.keywords=t)},null,8,["modelValue"])])),_:1}),V(d,{label:"SEO描述"},{default:q((()=>[V(n,{type:"textarea",modelValue:e.formSort.description,"onUpdate:modelValue":t[15]||(t[15]=t=>e.formSort.description=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1}))])),_:1}),V(m,{type:"primary",onClick:e.addOrUpdateSort},{default:q((()=>[G])),_:1},8,["onClick"]),e.update?(b(),y(m,{key:0,type:"warning",onClick:e.reset},{default:q((()=>[H])),_:1},8,["onClick"])):C("",!0)])}));P.render=Q,P.__scopeId="data-v-16ea7762";var R=n({name:"index",components:{sortDetail:P},setup(){const e=m(),t=p({activeName:"1",sortList:[],originSortList:[],addScode:"1",models:[],dialogVisible:!1,isEditSorting:!1,sortingList:[],multipleSelection:[]}),o=N((()=>x(t.sortList,"scode","0","pcode","children")));J().then((e=>{t.models=e})).catch((e=>{f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")}));const l=()=>{E({acode:e.state.acode}).then((e=>{e&&e.length&&(t.sortList=JSON.parse(JSON.stringify(e)),t.originSortList=JSON.parse(JSON.stringify(e)),t.addScode=(parseInt(JSON.parse(JSON.stringify(e)).reverse()[0].scode)+1).toString(),t.dialogVisible=!1)})).catch((e=>f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")))};return c((()=>e.state.acode),((e,t)=>{l()})),l(),d(s({},u(t)),{sortTree:o,getSortList:l})},methods:{deleteSort(e){let t;t=e.children?T(e,"children",!0).map((e=>({id:e.id}))):{id:e.id},j(t).then((e=>{f.success("删除成功"),this.getSortList()})).catch((e=>f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")))},getModelLabel(e){return this.models.find((t=>t.mcode===e)).name},async openUpdateDialog(e){this.dialogVisible=!0,await this.$nextTick(),this.$refs.sortDialog.formSort=JSON.parse(JSON.stringify(e)),this.$refs.sortDialog.originFormSort=JSON.parse(JSON.stringify(e))},addSortDone(){this.activeName="1",this.getSortList()},changeSorting(e){const t=Number(e.sorting),o=this.sortingList.find((t=>t.id===e.id));if(o)o.sorting=t;else{const o=this.originSortList.find((t=>t.id===e.id));o.sorting=t,this.sortingList.push(o)}},updateSorting(){const e=this.sortingList.map((e=>({findOption:{id:e.id},data:e})));I(e).then((e=>{this.getSortList(),f.success("修改成功"),this.isEditSorting=!1})).catch((e=>f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")))},cancelSorting(){this.sortingList.forEach((e=>{var t;e.sorting=null==(t=this.originSortList.find((t=>t.id===e.id)))?void 0:t.sorting})),this.isEditSorting=!1},handleSelectionChange(e){this.multipleSelection=e,console.log(e)},deleteSortList(){const e=T(this.multipleSelection,"children",!0);if(!e.length)return;console.log(e);const t=e.map((e=>({id:e.id})));j(t).then((e=>{f.success("删除成功"),this.getSortList()})).catch((e=>f.error(e.message+"| 出错了，请过会儿再试（半分钟左右）")))}}});const W={key:0},X=w("启用"),Y=w("禁用"),Z=w("删除"),ee=w("修改"),te=w("批量删除"),oe=w("修改排序"),le={key:1,style:{"margin-left":"16px"}},ae=w("保存排序"),re=w("取消");R.render=function(e,t,o,l,a,r){const i=g("el-table-column"),s=g("el-input"),d=g("el-tag"),n=g("el-button"),u=g("el-popconfirm"),m=g("el-table"),p=g("el-row"),c=g("el-tab-pane"),f=g("sort-detail"),h=g("el-tabs"),S=g("el-dialog");return b(),y("div",null,[V(h,{modelValue:e.activeName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.activeName=t),"tab-position":"top"},{default:L((()=>[V(c,{label:"栏目列表",name:"1"},{default:L((()=>[V(m,{data:e.sortTree,border:"",style:{width:"100%"},"row-key":"id",onSelectionChange:e.handleSelectionChange},{default:L((()=>[V(i,{type:"selection",width:"40"}),V(i,{prop:"name",label:"栏目名称","min-width":"200"}),V(i,{prop:"scode",label:"栏目编码",width:"80"}),V(i,{prop:"pcode",label:"父编码",width:"70"}),V(i,{prop:"mcode",label:"模型",width:"70"},{default:L((({row:t})=>[V("p",null,O(e.getModelLabel(t.mcode)),1)])),_:1}),V(i,{prop:"listtpl",label:"列表页模板","min-width":"100"}),V(i,{prop:"contenttpl",label:"内容页模板","min-width":"100"}),V(i,{prop:"sorting",sortable:"",label:"排序",width:"80"},{default:L((({row:t})=>[e.isEditSorting?(b(),y(s,{key:1,modelValue:t.sorting,"onUpdate:modelValue":e=>t.sorting=e,onInput:o=>e.changeSorting(t)},null,8,["modelValue","onUpdate:modelValue","onInput"])):(b(),y("p",W,O(t.sorting),1))])),_:1}),V(i,{prop:"status",label:"状态","min-width":"50"},{default:L((({row:e})=>["1"===e.status?(b(),y(d,{key:0,type:"success"},{default:L((()=>[X])),_:1})):(b(),y(d,{key:1,type:"danger"},{default:L((()=>[Y])),_:1}))])),_:1}),V(i,{label:"操作",width:"180"},{default:L((({row:t})=>[V(u,{title:"确定删除吗？",onConfirm:o=>e.deleteSort(t)},{reference:L((()=>[V(n,{type:"danger",size:"small"},{default:L((()=>[Z])),_:1})])),_:2},1032,["onConfirm"]),V(n,{type:"primary",size:"small",onClick:o=>e.openUpdateDialog(t)},{default:L((()=>[ee])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"]),V(p,{type:"flex",style:{margin:"20px"}},{default:L((()=>[V(u,{title:"确定删除吗？",onConfirm:e.deleteSortList},{reference:L((()=>[V(n,{type:"danger"},{default:L((()=>[te])),_:1})])),_:1},8,["onConfirm"]),e.isEditSorting?(b(),y("div",le,[V(n,{type:"primary",onClick:e.updateSorting},{default:L((()=>[ae])),_:1},8,["onClick"]),V(n,{type:"primary",onClick:e.cancelSorting},{default:L((()=>[re])),_:1},8,["onClick"])])):(b(),y(n,{key:0,type:"primary",onClick:t[1]||(t[1]=t=>e.isEditSorting=!0)},{default:L((()=>[oe])),_:1}))])),_:1})])),_:1}),V(c,{label:"栏目新增",name:"2"},{default:L((()=>[V(f,{sortTree:e.sortTree,addScode:e.addScode,onUpdateSort:e.addSortDone,models:e.models},null,8,["sortTree","addScode","onUpdateSort","models"])])),_:1}),V(c,{label:"批量新增",name:"3"},{default:L((()=>[V(f,{sortTree:e.sortTree,addScode:e.addScode,onUpdateSort:e.addSortDone,models:e.models,batch:!0},null,8,["sortTree","addScode","onUpdateSort","models"])])),_:1})])),_:1},8,["modelValue"]),V(S,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=t=>e.dialogVisible=t),top:"5vh",width:"80%"},{default:L((()=>[V("div",null,[V(f,{ref:"sortDialog",sortTree:e.sortTree,onUpdateSort:e.getSortList,models:e.models,update:!0},null,8,["sortTree","onUpdateSort","models"])])])),_:1},8,["modelValue"])])};export default R;
